---
title: "Yeast KO Doubling Times"
subtitle: "Haploid Knock Out Library"
author: "Carson Stacy"
date: "2022-10-07"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, include=FALSE}
library(reactable)
library(tidyverse)
library(sparkline)
library(here)
library(ggpubr)
```

```{r, echo=FALSE, warning=FALSE, message = FALSE}
# library(readxl)
  # read_excel("~/Library/Group Containers/UBF8T346G9.Office/Outlook/Outlook 15 Profiles/Main Profile/Files/S0/1/Attachments/Persson_Adaption_2022_Data_S1_Dose_response[5017317].xlsx") 

Persson_Adaption_2022_Data_S1 <- read_delim("~/Downloads/Persson_2022_Data_S1.tsv", 
    delim = "\t", escape_double = FALSE, 
    trim_ws = TRUE) %>%
  filter(NaAsO2.mM == 0) %>% 
  mutate(Doubling.time = round(as.numeric(Doubling.time),2)) %>%
  group_by(Gene.Standard, Gene.Systematic) %>%
  select(!NaAsO2.mM) %>%
  janitor::clean_names() %>%
  arrange(gene_systematic) %>%
  relocate(gene_standard,gene_systematic)



tmp <- Persson_Adaption_2022_Data_S1 %>%
  group_by(gene_standard, gene_systematic) %>%
  mutate(doubling_time= doubling_time*60) %>%
  summarise(doubling_times = list(doubling_time),
            mean = mean(doubling_time, na.rm=TRUE),
            median = median(doubling_time),
            min = min(doubling_time, na.rm=TRUE),
            max = max(doubling_time)
            ) %>%
  mutate(boxplot = NA) %>% 
  mutate(across(where(is.numeric), round, 0)) %>%
  mutate_if(is.numeric, list(~na_if(., Inf)))

tmp_adj <- Persson_Adaption_2022_Data_S1 %>%
  group_by(gene_standard, gene_systematic) %>%
  mutate(doubling_time_adj= doubling_time*60*(90/104)) %>%
  summarise(doubling_times = list(doubling_time_adj),
            mean = mean(doubling_time_adj, na.rm=TRUE),
            median = median(doubling_time_adj),
            min = min(doubling_time_adj, na.rm=TRUE),
            max = max(doubling_time_adj)
            ) %>%
  mutate(boxplot = NA) %>% 
  mutate(across(where(is.numeric), round, 0)) %>%
  mutate_if(is.numeric, list(~na_if(., Inf)))

write_csv(tmp[-8], "~/Documents/GitHub/yeastKODoublingTimes/Persson_Adaption_2022_Data_S1_Doubling_times.csv")

write_csv(tmp_adj[-8], "~/Documents/GitHub/yeastKODoublingTimes/Persson_Adaption_2022_Data_S1_Doubling_times_normalized.csv")
```


A searchable table of doubling time estimates for haploid yeast from the KO library. Data from https://doi.org/10.1093/g3journal/jkac240. The creator of this resource provides no guarantee of the accuracy of estimates shown here. Times have been corrected by a factor of $\approx0.865$ to scale from the doubling times observed in time-lapse microscopy on YPD to batch doubling time observed in liquid 1X YPD. More details on normalization strategy available [below](#more-information-about-normalization-technique-used).


### Doubling Times

```{r echo=FALSE}
# reactable(tmp)

reactable(
  tmp_adj,
  searchable = TRUE,
  filterable = TRUE,
  defaultPageSize = 30,
  # groupBy = "gene_standard",
  # defaultColDef = colDef(
  #   header = function(value) gsub("_", " ", value, fixed = TRUE),
  #   cell = function(value) format(value, nsmall = 1),
  #   align = "center",
  #   minWidth = 70,
  #   headerStyle = list(background = "#f7f7f8")
  # ),
  columns = list(
    mean = colDef(
      name = "Average",
      html = TRUE,
      align = "left",
      header = JS('function(column) {
        return column.name + `<div style="color: #737373">minutes</div>`
      }')
    ),
    min = colDef(
      name = "Minimum",
      html = TRUE,
      align = "left",
      header = JS('function(column) {
        return column.name + `<div style="color: #737373">minutes</div>`
      }')
    ),
    max = colDef(
      name = "Maximum",
      html = TRUE,
      align = "left",
      header = JS('function(column) {
        return column.name + `<div style="color: #737373">minutes</div>`
      }')
    ),
    # mean = colDef(header = function(value) {
    #   tags$a(href = "https://wikipedia.org/wiki/List_of_Iris_species", value)
    # }),
    boxplot = colDef(name = "Boxplot", 
                     cell = function(value, index) {
      sparkline(tmp_adj$doubling_times[[index]], type = "bar")
    }),
    # mean_original = colDef(
    #   name = "Mean (Uncorrected)",
    #   html = TRUE,
    #   align = "left",
    #   header = JS('function(column) {
    #     return column.name + `<div style="color: #737373">minutes</div>`
    #   }')
    # ),
    doubling_times = colDef(show = FALSE),
    median = colDef(show=FALSE),
    gene_systematic = colDef(
      name = "ORF ID",
      html = TRUE,
      align = "left"
    ),
    gene_standard = colDef(
      name = "Gene name",
      html = TRUE,
      align = "center"
    )
  )
)


```
Raw data: [`Persson_Adaption_2022_Data_S1_Doubling_times_normalized.csv`](Persson_Adaption_2022_Data_S1_Doubling_times_normalized.csv)]


A distribution of all growth rates in the KO library. Graph has been truncated at 480 minute doubling times for ease of visibility.

```{r, echo=FALSE, warning=FALSE}
my_y_title <- expression(paste("KO Doubling Times on YPD agar (Raw Data)"))

p1 <- Persson_Adaption_2022_Data_S1 %>%
  ggplot(aes(x=doubling_time*60)) +
  geom_histogram(bins=300, fill = "blue") +
  scale_x_continuous(breaks = seq(60, 480, by = 30),
                     limits = c(80,480)) +
  # xlim(90,480) +
  # geom_vline(xintercept = quantile(Persson_modified$doubling_time*60,
                                   # 0.005, #quantile desired (top 0.05%, gives DT ~= 90 min)
                                   # na.rm=T)) +
  xlab("Doubling Time (minutes)") +
  theme_classic() +
  ggtitle(my_y_title)
```

<!-- Calculation for a *normalized* growth rate here, to convert to a liquid media growth rate -->
```{r, echo=FALSE, warning=FALSE, include=FALSE}
Persson_Adaption_2022_Data_S1 %>%
  ungroup() %>%
  dplyr::summarise(mode = quantile(doubling_time, 0.005, na.rm = TRUE)*60) # top 0.05% growth quantile of all mutants 
# (b/c no control was present in the raw data)
```

### More information about normalization technique used

```{r, echo=FALSE, warning=FALSE}
Persson_modified <- Persson_Adaption_2022_Data_S1 %>%
  mutate(doubling_time_adj = doubling_time*60*(90/104)) #conversion from median 104 min doubling time (value inspired from this paper and Levy, 2012) to 90 minute (default for BY haploid in YPD)

#ggtitle
my_y_title2 <- expression(paste("KO Doubling Times ", italic("\"normalized\""), " to liquid media"))

p2 <- Persson_modified %>%
  ggplot(aes(x=doubling_time_adj)) +
  geom_histogram(bins=300, fill = "blue") +
  # geom_vline(xintercept = quantile(Persson_modified$doubling_time_adj,
  #                                  0.005, #quantile desired (top 1%, gives DT ~= 91 min)
  #                                  na.rm=T)) +
  xlab("Doubling Time (minutes)") +
  scale_x_continuous(breaks = seq(60, 480, by = 30),
                     limits = c(80,480)) +
    # xlim(80,480) +
  theme_classic() +
  ggtitle(my_y_title2)

ggarrange(p1,
          p2, 
          nrow=2, 
          ncol=1)
```

This dataset did not have a WT control to compare directly doubling times. However, the doubling times observed here closely match those from Levy et al, 2012 (doubling time $\approx 104$ minutes). Given the haploid S299C strain BY background has a doubling time of approximately 90 minutes in batch culture, a correction of $\frac{90}{104}$ was utilized here to provide a better estimate for batch culture growth.

### Original data Doubling Times (without correction)

For use with estimating growth rates on 1X YPD agar via timelapse microscopy.
```{r echo=F}
reactable(
  tmp,
  searchable = TRUE,
  filterable = TRUE,
  defaultPageSize = 3,
  # groupBy = "gene_standard",
  # defaultColDef = colDef(
  #   header = function(value) gsub("_", " ", value, fixed = TRUE),
  #   cell = function(value) format(value, nsmall = 1),
  #   align = "center",
  #   minWidth = 70,
  #   headerStyle = list(background = "#f7f7f8")
  # ),
  columns = list(
    mean = colDef(
      name = "Average",
      html = TRUE,
      align = "left",
      header = JS('function(column) {
        return column.name + `<div style="color: #737373">minutes</div>`
      }')
    ),
    min = colDef(
      name = "Minimum",
      html = TRUE,
      align = "left",
      header = JS('function(column) {
        return column.name + `<div style="color: #737373">minutes</div>`
      }')
    ),
    max = colDef(
      name = "Maximum",
      html = TRUE,
      align = "left",
      header = JS('function(column) {
        return column.name + `<div style="color: #737373">minutes</div>`
      }')
    ),
    # mean = colDef(header = function(value) {
    #   tags$a(href = "https://wikipedia.org/wiki/List_of_Iris_species", value)
    # }),
    boxplot = colDef(name = "Boxplot",
                     cell = function(value, index) {
      sparkline(tmp$doubling_times[[index]], type = "bar")
    }),
    doubling_times = colDef(show = FALSE),
    median = colDef(show=FALSE),
    gene_systematic = colDef(
      name = "ORF ID",
      html = TRUE,
      align = "left"
    ),
    gene_standard = colDef(
      name = "Gene name",
      html = TRUE,
      align = "center"
    )
  )
)
```

